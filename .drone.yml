kind: pipeline
name: default

platform:
  os: linux
  arch: amd64

steps:
- name: test
  image: golang
  privileged: true
  environment:
    COVERALLS_TOKEN:
      from_secret: coveralls_token
  commands:
  - apt update
  - apt install lsof net-tools
  - iptables -D ufw-before-input -m conntrack --ctstate INVALID -j DROP || echo "Rule not found"
  - go test -covermode=count -coverprofile=profile.cov
  - go get github.com/mattn/goveralls
  - goveralls -coverprofile=profile.cov -service drone.io