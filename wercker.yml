# This references the default golang container from
# the Docker Hub: https://registry.hub.docker.com/u/library/golang/
# If you want Google's container you would reference google/golang
# Read more about containers on our dev center
# http://devcenter.wercker.com/docs/containers/index.html
box: golang:1.12.5
# This is the build pipeline. Pipelines are the core of wercker
# Read more about pipelines on our dev center
# http://devcenter.wercker.com/docs/pipelines/index.html
build:
# The steps that will be executed on build
# Steps make up the actions in your pipeline
# Read more about steps on our dev center:
# http://devcenter.wercker.com/docs/steps/index.html
  steps:
    # Sets the go workspace and places you package
    # at the right place in the workspace tree
    - wercker/setup-go-workspace:
      package-dir: github.com/getlantern/gonat
    - script:
      name: enable-conntrack
      code: sudo modprobe nf_conntrack && sudo modprobe nf_conntrack_ipv4
    - script:
      name: get goveralls
      code: |-
        go get golang.org/x/tools/cmd/cover
        go get -v github.com/mattn/goveralls
    - script:
      name: test-and-cover
      code: ./test.sh
    - tcnksm/goveralls:
      token: 19Nno28mzRG0nIrWOc92flFUhZF2ty4Rc
